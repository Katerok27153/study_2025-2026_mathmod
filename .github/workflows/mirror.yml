name: Mirror to GitVerse

on:
  push:
    branches: [ main, master ]
    tags: [ '*' ]
  release:
    types: [published, edited]
  workflow_dispatch:

jobs:
  mirror:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
        fetch-tags: true
    
    - name: Push to GitVerse
      run: |
        git remote add gitverse https://${{ secrets.GITVERSE_TOKEN }}@gitverse.ru/Katerok27153/study_2025-2026_mathmod.git
        
        # Отправляем все ветки (без удаления)
        echo "Pushing branches..."
        git push gitverse --all --force-with-lease
        
        # Отправляем все теги (без удаления)
        echo "Pushing tags..."
        git push gitverse --tags --force-with-lease
        
        # Явно отправляем main/master если они есть
        echo "Ensuring default branches..."
        git push gitverse origin/main:main --force-with-lease || true
        git push gitverse origin/master:master --force-with-lease || true
