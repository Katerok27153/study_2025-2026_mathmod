name: Mirror to GitVerse

on:
  push:
    branches: [ main, master ]
    tags: [ '*' ]
  release:
    types: [published, edited]
  workflow_dispatch:

jobs:
  mirror:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
        fetch-tags: true
    
    - name: Push to GitVerse
      run: |
        git remote add gitverse https://${{ secrets.GITVERSE_TOKEN }}@gitverse.ru/Katerok27153/study_2025-2026_mathmod.git
        
 	# Получаем актуальное состояние с GitVerse
        git fetch gitverse
        
        # Отправляем ветки с force-with-lease (теперь должно работать)
        echo "Pushing branches..."
        git push gitverse --all --force-with-lease || git push gitverse --all --force
        
        # Отправляем теги
        echo "Pushing tags..."
        git push gitverse --tags --force-with-lease || git push gitverse --tags --force
